---
title: "Spectral Statistics of Normal Random Matrices"
author: "Ali Taqi"
output: pdf_document
#  includes: 
#    in_header: preamble.tex
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = TRUE, fig.align = "center", 
                      message = FALSE, warning = FALSE)
library(tidyverse)
library(knitr)
library(patchwork)
library(gridExtra)
library(matrixcalc)
# Load files
source(file = "../R/matrices.R")
source(file = "../R/eigen.R")
source(file = "../R/simulate.R")
source(file = "../R/analyze.R")
source(file = "../R/vis.R")
# global parameters
bool_plot <- F
bool_loud <- F
bool_animate <- F
```

# Consecutive Ratio Sequence: Symmetric Normal Matrix

```{r}
# Matrix parameters
n <- 4
mean <- 0
sd <- 2
# Batch parameters
batch_size <- 100
steps <- 20
epsilon <- 0.05
```

```{r}
set.seed(23)
# Generate a matrix
P <- RM_stoch(n, symm = T)
# Evolve a batch
sim <- mixtime_sim(P, batch_size, steps, epsilon)
# Extract arrays
batch <- sim[[1]]
evolved_batch <- sim[[2]]
# Get eigenvalues
eigenvalues <- eigen(P)$values
if(bool_loud){eigenvalues}
```

## Log-Variance over Time

```{r}
if(!bool_plot){variance_by_time(evolved_batch, min_time = 1)/variance_by_time(evolved_batch, min_time = 10)}
```

## Log-Ratio Distribution

```{r}
eigenvalues
```

```{r}
max_time <- max(evolved_batch$time)
mean_mixtime <- mean(batch$mixtime)
ratios <- data.frame(ratio = ratios_by_time(evolved_batch, at_time = 5:14, log = F))
ratios_histogram(ratios, bins = 40)
```

## Ratio of Two Normal Variables

```{r}
set.seed(23)
df <- 100
norm1 <- rnorm(n = 10000, mean = mean, sd = 2)
norm2 <- rnorm(n = 10000, mean = mean, sd = 2)
ratio_norm <- data.frame(ratio_norm = norm1/norm2)
ggplot(data = ratio_norm, mapping = aes(x = ratio_norm)) + geom_histogram() + xlim(c(-10,10))
```

## Ratio of Two Chi-Squared Variables

```{r}
set.seed(23)
df <- 100
chi1 <- rchisq(n = 10000, df = df)
chi2 <- rchisq(n = 10000, df = df)
ratio_chi <- data.frame(ratio_chi = chi1/chi2)
ggplot(data = ratio_chi, mapping = aes(x = ratio_chi)) + geom_histogram()
```

```{r}
# Extract ratios
#ratios <- extract_ratios(sim[[2]])
#rxos <- ratios$r_x1
#rxos <- data.frame(rx = sort(rxos[!is.na(rxos)]))
#qqnorm(rxos$rx)
```

```{r}
#sim_r <- data.frame(rx = sort(rcauchy(n = 2500, location = eigenvalues[1], scale = 2)))
#qqnorm(sim_r$rx)
```




